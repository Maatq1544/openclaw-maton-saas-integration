<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tommy Frame Bridge</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: #000; color: #fff; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; text-align: center; }
        .container { padding: 20px; border: 1px solid #333; border-radius: 15px; background: #111; width: 80%; max-width: 400px; }
        h1 { color: #d32f2f; margin-bottom: 10px; }
        p { color: #888; font-size: 0.9rem; margin-bottom: 30px; }
        #connect-btn { background: #d32f2f; color: white; border: none; padding: 15px 40px; border-radius: 30px; font-size: 1.1rem; font-weight: bold; cursor: pointer; box-shadow: 0 4px 15px rgba(211, 47, 47, 0.4); }
        #status { margin-top: 30px; font-family: monospace; font-size: 0.8rem; color: #555; }
        .status-active { color: #4caf50 !important; }
    </style>
</head>
<body>
    <div class="container">
        <h1>TOMMY BRIDGE</h1>
        <p>Direct pipe between your AR Frame and Tommy's brain.</p>
        <button id="connect-btn">LINK GLASSES</button>
        <div id="status">OFFLINE</div>
    </div>

    <script>
        const btn = document.getElementById('connect-btn');
        const status = document.getElementById('status');
        let device, rxCharacteristic, txCharacteristic;
        
        async function onDisconnected() {
            status.className = "";
            status.innerText = "DISCONNECTED. RECONNECTING...";
            btn.style.display = "block";
            try {
                await device.gatt.connect();
            } catch (e) {
                status.innerText = "LOST CONNECTION. TAP LINK TO RETRY.";
            }
        }

        btn.onclick = async () => {
            try {
                status.innerText = "SCANNING FOR FRAME...";
                device = await navigator.bluetooth.requestDevice({
                    filters: [{ namePrefix: 'Frame' }],
                    optionalServices: ['7a230001-5475-a6a4-654c-8431f6ad49c4']
                });
                
                device.addEventListener('gattserverdisconnected', onDisconnected);

                status.innerText = "CONNECTING TO " + device.name.toUpperCase() + "...";
                const server = await device.gatt.connect();
                const service = await server.getPrimaryService('7a230001-5475-a6a4-654c-8431f6ad49c4');
                
                txCharacteristic = await service.getCharacteristic('7a230002-5475-a6a4-654c-8431f6ad49c4');
                rxCharacteristic = await service.getCharacteristic('7a230003-5475-a6a4-654c-8431f6ad49c4');
                
                status.className = "status-active";
                status.innerText = "LINKED: " + device.name.toUpperCase() + ". SYSTEM STABLE.";
                btn.style.display = "none";
                
                // Keep-alive: send a break signal every 15s to prevent sleep
                setInterval(async () => {
                    if (txCharacteristic) {
                        try { await txCharacteristic.writeValue(new Uint8Array([0x03])); } catch(e) {}
                    }
                }, 15000);
                
            } catch (err) {
                status.innerText = "ERROR: " + err.message.toUpperCase();
                console.error(err);
            }
        };
    </script>
</body>
</html>
